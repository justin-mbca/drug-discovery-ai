<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Parkinson's Research Monitor</title>
    <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background: #f5f5f5; }
        .container { max-width: 1400px; margin: 0 auto; padding: 20px; }
        .header { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; padding: 30px; border-radius: 10px; margin-bottom: 30px; }
        .header h1 { font-size: 2.5rem; margin-bottom: 10px; }
        .stats { display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 20px; margin-bottom: 30px; }
        .stat-card { background: white; padding: 25px; border-radius: 10px; box-shadow: 0 4px 6px rgba(0,0,0,0.1); }
        .stat-card h3 { color: #666; margin-bottom: 10px; font-size: 1rem; }
        .stat-card .value { font-size: 2.5rem; font-weight: bold; color: #764ba2; }
        .charts { display: grid; grid-template-columns: repeat(auto-fit, minmax(500px, 1fr)); gap: 20px; margin-bottom: 30px; }
        .chart-container { background: white; padding: 20px; border-radius: 10px; box-shadow: 0 4px 6px rgba(0,0,0,0.1); }
        .articles-list, .trials-list { background: white; padding: 20px; border-radius: 10px; box-shadow: 0 4px 6px rgba(0,0,0,0.1); margin-bottom: 30px; }
        .article-item, .trial-item { border-bottom: 1px solid #eee; padding: 15px 0; }
        .article-item:last-child, .trial-item:last-child { border-bottom: none; }
        .article-title { font-weight: bold; margin-bottom: 5px; }
        .article-meta { color: #666; font-size: 0.9rem; margin-bottom: 5px; }
        .article-genes span { background: #e0e7ff; color: #4f46e5; padding: 2px 8px; border-radius: 12px; font-size: 0.8rem; margin-right: 5px; }
        .trial-phase { display: inline-block; padding: 3px 10px; border-radius: 12px; font-size: 0.8rem; margin-right: 10px; }
        .phase-1 { background: #fef3c7; color: #92400e; }
        .phase-2 { background: #dbeafe; color: #1e40af; }
        .phase-3 { background: #d1fae5; color: #065f46; }
        .last-updated { text-align: center; color: #666; margin-top: 20px; }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>Parkinson's Disease Research Monitor</h1>
            <p>Automated monitoring of literature, clinical trials, and gene targets</p>
        </div>
        <div class="stats" id="stats">
            <div class="stat-card">
                <h3>Total Articles</h3>
                <div class="value" id="total-articles">-</div>
            </div>
            <div class="stat-card">
                <h3>Total Clinical Trials</h3>
                <div class="value" id="total-trials">-</div>
            </div>
            <div class="stat-card">
                <h3>Top Source</h3>
                <div class="value" id="top-source">-</div>
            </div>
            <div class="stat-card">
                <h3>Last Updated</h3>
                <div class="value" id="last-updated">-</div>
            </div>
        </div>
        <div class="charts">
            <div class="chart-container">
                <h3>Top Gene Targets</h3>
                <div id="top-genes-chart" style="height:350px;"></div>
            </div>
        </div>
        <div class="articles-list">
            <h2>Recent Articles</h2>
            <div id="articles"></div>
        </div>
        <div class="trials-list">
            <h2>Recent Clinical Trials</h2>
            <div id="trials"></div>
        </div>
        <div class="last-updated" id="footer-updated"></div>
    </div>
    <script>
    async function loadSummary() {
        const res = await axios.get('/api/summary');
        const d = res.data;
        document.getElementById('total-articles').textContent = d.total_articles;
        document.getElementById('total-trials').textContent = d.total_trials;
        let topSource = '-';
        if (d.sources && Object.keys(d.sources).length > 0) {
            topSource = Object.entries(d.sources).sort((a,b)=>b[1]-a[1])[0][0];
        }
        document.getElementById('top-source').textContent = topSource;
        document.getElementById('last-updated').textContent = d.last_updated ? new Date(d.last_updated).toLocaleString() : '-';
        document.getElementById('footer-updated').textContent = 'Last updated: ' + (d.last_updated ? new Date(d.last_updated).toLocaleString() : '-');
        // Top genes bar chart
        const genes = Object.keys(d.top_genes || {});
        const counts = Object.values(d.top_genes || {});
        Plotly.newPlot('top-genes-chart', [{
            x: genes,
            y: counts,
            type: 'bar',
            marker: {color: '#764ba2'}
        }], {
            margin: {t: 30},
            yaxis: {title: 'Mentions'},
            xaxis: {title: 'Gene'}
        }, {displayModeBar: false});
    }
    async function loadArticles() {
        const res = await axios.get('/api/recent_articles');
        const articles = res.data;
        const el = document.getElementById('articles');
        if (!articles.length) {
            el.innerHTML = '<div>No articles found.</div>';
            return;
        }
        el.innerHTML = articles.map(a => `
            <div class="article-item">
                <div class="article-title"><a href="${a.url}" target="_blank">${a.title}</a></div>
                <div class="article-meta">
                    ${a.authors || ''} | Source: ${a.source || ''} | Score: ${a.relevance_score != null ? a.relevance_score.toFixed(2) : '-'}<br>
                    <span style="color:#888;">Published: ${a.publication_date || '-'}</span>
                </div>
                <div class="article-genes">${(a.genes||[]).map(g=>`<span>${g}</span>`).join('')}</div>
            </div>
        `).join('');
    }
    async function loadTrials() {
        const res = await axios.get('/api/clinical_trials');
        const trials = res.data;
        const el = document.getElementById('trials');
        if (!trials.length) {
            el.innerHTML = '<div>No clinical trials found.</div>';
            return;
        }
        el.innerHTML = trials.map(t => `
            <div class="trial-item">
                <div><a href="${t.url}" target="_blank">${t.title}</a></div>
                <div class="trial-phase phase-${(t.phase||'').replace(/[^0-9]/g,'')}">${t.phase || ''}</div>
                <span>Status: ${t.status || ''}</span>
                <div>Targets: ${(t.targets||[]).map(g=>`<span>${g}</span>`).join('')}</div>
            </div>
        `).join('');
    }
    window.onload = function() {
        loadSummary();
        loadArticles();
        loadTrials();
    };
    </script>
</body>
</html>
